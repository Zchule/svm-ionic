{"version":3,"sources":["../../src/pages/supervisor/map-generic/map-generic.module.ts","../../src/pages/supervisor/map-generic/map-generic.ts"],"names":[],"mappings":"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","file":"3.js","sourcesContent":["import { NgModule } from '@angular/core';\nimport { IonicPageModule } from 'ionic-angular';\nimport { MapGenericPage } from './map-generic';\n\n@NgModule({\n  declarations: [\n    MapGenericPage,\n  ],\n  imports: [\n    IonicPageModule.forChild(MapGenericPage),\n  ],\n})\nexport class MapGenericPageModule {}\n\n\n\n// WEBPACK FOOTER //\n// ./src/pages/supervisor/map-generic/map-generic.module.ts","import { Component } from '@angular/core';\r\nimport { IonicPage, Loading, LoadingController, AlertController } from 'ionic-angular';\r\n\r\nimport { MapGenericService } from '../../../providers/map-generic.service';\r\nimport { Storage } from '@ionic/storage';\r\nimport { Network } from '@ionic-native/network';\r\nimport { Subscription } from 'rxjs/Subscription';\r\n\r\ndeclare var google;\r\n\r\n@IonicPage()\r\n@Component({\r\n  selector: 'page-map-generic',\r\n  templateUrl: 'map-generic.html',\r\n})\r\nexport class MapGenericPage {\r\n\r\n  map: any;\r\n  bounds: any = null;\r\n  myLatLng: any;\r\n  waypoints: any[];\r\n  load: Loading;\r\n  vendedores: any = {};\r\n  infowindow: any;\r\n  fecha: string;\r\n  imeiCel: string;\r\n\r\n  subscriptions: Subscription[] = [];\r\n\r\n  constructor(\r\n    private loadCtrl: LoadingController,\r\n    public alertCtrl: AlertController,\r\n    private mapGenericService: MapGenericService,\r\n    private storage: Storage,\r\n    private network: Network\r\n  ) {\r\n    this.bounds = new google.maps.LatLngBounds();\r\n    this.infowindow = new google.maps.InfoWindow();\r\n   }\r\n\r\n  ionViewDidLoad() {\r\n    this.load = this.loadCtrl.create({\r\n      content: 'Cargando...'\r\n    });\r\n    this.load.present();\r\n    const subscriptionFechaServidor = this.mapGenericService.getFechaServidor()\r\n    .valueChanges()\r\n    .subscribe((data: any) => {\r\n      this.fecha = data.fecha;\r\n      this.checkImei();\r\n    });\r\n    this.subscriptions.push(subscriptionFechaServidor);\r\n    this.verificarInternet();\r\n  }\r\n\r\n  ionViewDidLeave() {\r\n    this.subscriptions.forEach((subscription) => {\r\n      subscription.unsubscribe();\r\n    });\r\n  }\r\n\r\n  private verificarInternet() {\r\n    if (this.network.type === 'none') {\r\n      console.log(this.network.type);\r\n      const alert = this.alertCtrl.create({\r\n        title: 'Sin conexiÃ³n',\r\n        subTitle: 'Necesita conectarse a internet',\r\n        buttons: ['OK']\r\n      });\r\n      alert.present();\r\n      this.load.dismiss();\r\n    }\r\n  }\r\n\r\n  private loadMap() {\r\n    // create a new map by passing HTMLElement\r\n    const mapEle: HTMLElement = document.getElementById('map');\r\n\r\n    const latitud = -17.2378799;\r\n    const longitud = -66.7239997;\r\n\r\n    // create LatLng object\r\n    const myLatLng = { lat: latitud, lng: longitud };\r\n    // create map\r\n    this.map = new google.maps.Map(mapEle, {\r\n      center: myLatLng,\r\n      zoom: 12\r\n    });\r\n\r\n    google.maps.event.addListenerOnce(this.map, 'idle', () => {\r\n      mapEle.classList.add('show-map');\r\n      this.load.dismiss();\r\n      this.obtenerVendedores();\r\n    });\r\n   }\r\n\r\n  private obtenerVendedores() {\r\n    const subscriptionVendedoresChannel = this.mapGenericService.getVendedoresChannelOb()\r\n    .subscribe(vendedor => {\r\n      console.log('subscriptionVendedoresChannel', vendedor);\r\n      if (vendedor !== null) {\r\n        if (this.vendedores.hasOwnProperty(vendedor.imei)) { // ya lo tengo\r\n          this.vendedores[vendedor.imei].data = vendedor;\r\n          const lat = vendedor.posicionActual.latitud;\r\n          const lng = vendedor.posicionActual.longitud;\r\n          this.vendedores[vendedor.imei].marker.setPosition({\r\n            lat: lat,\r\n            lng: lng\r\n          });\r\n        } else { // no lo tengo\r\n          this.vendedores[vendedor.imei] = {};\r\n          this.vendedores[vendedor.imei].data = vendedor;\r\n          const lat = vendedor.posicionActual.latitud;\r\n          const lng = vendedor.posicionActual.longitud;\r\n          const icon = './assets/imgs/vendedor.png';\r\n          const title = vendedor.nombreVendedor;\r\n          this.vendedores[vendedor.imei].marker = this.createMarker(lat, lng, icon, title);\r\n          this.fixBounds(lat, lng);\r\n        }\r\n      } else {\r\n        const alert = this.alertCtrl.create({\r\n          title: 'Sin Datos',\r\n          subTitle: 'No se tiene Registros',\r\n          buttons: ['OK']\r\n        });\r\n        alert.present();\r\n      }\r\n    });\r\n    this.subscriptions.push(subscriptionVendedoresChannel);\r\n    this.mapGenericService.getVendedoresMapGeneric(this.imeiCel, this.fecha);\r\n  }\r\n\r\n  private createMarker(lat: number, lng: number, icon: string, title: string) {\r\n    const options = {\r\n      position: {\r\n        lat: lat,\r\n        lng: lng\r\n      },\r\n      title: title,\r\n      map: this.map,\r\n      icon: icon\r\n      // zIndex: (Math.round(lat * -100000)<<5)\r\n    };\r\n    const marker = new google.maps.Marker(options);\r\n    const contentString = '<div>' +\r\n    '<div>VENDEDOR: <br><b>' + title + '</b> </div>';\r\n\r\n    marker.addListener('click', () => {\r\n      this.infowindow.setContent(contentString);\r\n      this.infowindow.open(this.map, marker);\r\n    });\r\n    return marker;\r\n  }\r\n\r\n  private fixBounds(lat: number, lng: number) {\r\n    const point = new google.maps.LatLng(lat, lng);\r\n    this.bounds.extend(point);\r\n    this.map.fitBounds(this.bounds);\r\n  }\r\n\r\n  private checkImei() {\r\n    this.storage.get('imei')\r\n    .then(imei => {\r\n      console.log('imei llego', imei);\r\n      // this.imeiCel = '354152087178696';\r\n      this.imeiCel = imei;\r\n      this.loadMap();\r\n    });\r\n  }\r\n\r\n}\r\n\n\n\n// WEBPACK FOOTER //\n// ./src/pages/supervisor/map-generic/map-generic.ts"],"sourceRoot":""}