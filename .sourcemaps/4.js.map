{"version":3,"sources":["../../src/pages/map-generic-sup/map-generic-sup.module.ts","../../src/pages/map-generic-sup/map-generic-sup.ts"],"names":[],"mappings":"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","file":"4.js","sourcesContent":["import { NgModule } from '@angular/core';\nimport { IonicPageModule } from 'ionic-angular';\nimport { MapGenericSupPage } from './map-generic-sup';\n\n@NgModule({\n  declarations: [\n    MapGenericSupPage,\n  ],\n  imports: [\n    IonicPageModule.forChild(MapGenericSupPage),\n  ],\n})\nexport class MapGenericSupPageModule {}\n\n\n\n// WEBPACK FOOTER //\n// ./src/pages/map-generic-sup/map-generic-sup.module.ts","import { Component } from '@angular/core';\nimport { IonicPage, Loading, LoadingController, AlertController } from 'ionic-angular';\n\nimport { MapGenericSupService } from '../../providers/map-generic-sup';\nimport { Storage } from '@ionic/storage';\nimport { Network } from '@ionic-native/network';\nimport { Subscription } from 'rxjs/Subscription';\n\ndeclare var google;\n\n@IonicPage()\n@Component({\n  selector: 'page-map-generic-sup',\n  templateUrl: 'map-generic-sup.html',\n})\nexport class MapGenericSupPage {\n\n  map: any;\n  bounds: any = null;\n  myLatLng: any;\n  waypoints: any[];\n  load: Loading;\n  vendedores: any = {};\n  infowindow: any;\n  fecha: string;\n  imeiCel: string;\n\n  subscriptions: Subscription[] = [];\n\n  constructor(\n    private loadCtrl: LoadingController,\n    public alertCtrl: AlertController,\n    private mapGenericService: MapGenericSupService,\n    private storage: Storage,\n    private network: Network\n  ) {\n    this.bounds = new google.maps.LatLngBounds();\n    this.infowindow = new google.maps.InfoWindow();\n  }\n\n  ionViewDidLoad() {\n    console.log('ionViewDidLoad MapGenericSupPage');\n    this.load = this.loadCtrl.create({\n      content: 'Cargando...'\n    });\n    this.load.present();\n    const subscriptionFechaServidor = this.mapGenericService.getFechaServidor()\n    .valueChanges()\n    .subscribe((data: any) => {\n      this.fecha = data.fecha;\n      this.checkImei();\n    });\n    this.subscriptions.push(subscriptionFechaServidor);\n    this.verificarInternet();\n  }\n\n  ionViewDidLeave() {\n    this.subscriptions.forEach((subscription) => {\n      subscription.unsubscribe();\n    });\n  }\n\n  private verificarInternet() {\n    if (this.network.type === 'none') {\n      console.log(this.network.type);\n      const alert = this.alertCtrl.create({\n        title: 'Sin conexiÃ³n',\n        subTitle: 'Necesita conectarse',\n        buttons: ['OK']\n      });\n      alert.present();\n      this.load.dismiss();\n    }\n  }\n\n  private loadMap() {\n    // create a new map by passing HTMLElement\n    const mapEle: HTMLElement = document.getElementById('map');\n\n    const latitud = -17.2378799;\n    const longitud = -66.7239997;\n\n    // create LatLng object\n    const myLatLng = { lat: latitud, lng: longitud };\n    // create map\n    this.map = new google.maps.Map(mapEle, {\n      center: myLatLng,\n      zoom: 12\n    });\n\n    google.maps.event.addListenerOnce(this.map, 'idle', () => {\n      mapEle.classList.add('show-map');\n      this.load.dismiss();\n      this.obtenerVendedores();\n    });\n   }\n\n  private obtenerVendedores() {\n    const subscriptionVendedoresChannel = this.mapGenericService.getVendedoresChannelOb()\n    .subscribe(vendedor => {\n      console.log('subscriptionVendedoresChannel', vendedor);\n      if (vendedor !== null) {\n        if (this.vendedores.hasOwnProperty(vendedor.imei)) { // ya lo tengo\n          this.vendedores[vendedor.imei].data = vendedor;\n          const lat = vendedor.posicionActual.latitud;\n          const lng = vendedor.posicionActual.longitud;\n          this.vendedores[vendedor.imei].marker.setPosition({\n            lat: lat,\n            lng: lng\n          });\n        } else { // no lo tengo\n          this.vendedores[vendedor.imei] = {};\n          this.vendedores[vendedor.imei].data = vendedor;\n          const lat = vendedor.posicionActual.latitud;\n          const lng = vendedor.posicionActual.longitud;\n          const icon = './assets/imgs/vendedor.png';\n          const title = vendedor.nombreVendedor;\n          this.vendedores[vendedor.imei].marker = this.createMarker(lat, lng, icon, title);\n          this.fixBounds(lat, lng);\n        }\n      }\n    });\n    this.subscriptions.push(subscriptionVendedoresChannel);\n    this.mapGenericService.getVendedoresMapGeneric(this.imeiCel, this.fecha);\n  }\n\n  private createMarker(lat: number, lng: number, icon: string, title: string) {\n    const options = {\n      position: {\n        lat: lat,\n        lng: lng\n      },\n      title: title,\n      map: this.map,\n      icon: icon\n      // zIndex: (Math.round(lat * -100000)<<5)\n    };\n    const marker = new google.maps.Marker(options);\n    const contentString = '<div>' +\n    '<div>VENDEDOR: <br><b>' + title + '</b> </div>';\n\n    marker.addListener('click', () => {\n      this.infowindow.setContent(contentString);\n      this.infowindow.open(this.map, marker);\n    });\n    return marker;\n  }\n\n  private fixBounds(lat: number, lng: number) {\n    const point = new google.maps.LatLng(lat, lng);\n    this.bounds.extend(point);\n    this.map.fitBounds(this.bounds);\n  }\n\n  private checkImei() {\n    this.storage.get('imei')\n    .then(imei => {\n      console.log('imei llego', imei);\n      // this.imeiCel = '354152087178696';\n      this.imeiCel = imei;\n      this.loadMap();\n    });\n  }\n  \n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/pages/map-generic-sup/map-generic-sup.ts"],"sourceRoot":""}